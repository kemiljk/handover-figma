<head>
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
</head>

<body style="display: none">
  <div class="container-top fixed mx-auto z-1 w-full pt-2 pb-4 px-4 border-b-2 border-gray-200">
    <div class="flex w-full mx-auto space-x-2">
      <div class="flex flex-col w-1/4">
        <h5 class="pb-2 font-bold text-xs">Base px</h5>
        <input class="w-full py-2 p-2 text-xs border-2  rounded-lg focus:outline-none" type="number" id="newPx"
          value="16">
      </div>
      <div class="flex flex-col w-3/4">
        <h5 class="pb-2 font-bold text-xs">Scale</h5>
        <div class="relative">
          <select name="conversionScale" id="scale"
            class="w-full py-2 px-2 text-xs border-2  rounded-lg  focus:outline-none">
            <option value="1.000" selected>Browser default (1.000)</option>
            <option value="1.067">Minor second (1.067)</option>
            <option value="1.125">Major second (1.125)</option>
            <option value="1.200">Minor third (1.200)</option>
            <option value="1.250">Major third (1.250)</option>
            <option value="1.333">Perfect fourth (1.333)</option>
            <option value="1.414">Augmented fourth (1.414)</option>
            <option value="1.500">Perfect fifth (1.500)</option>
            <option value="1.618">Golden ratio (1.618)</option>
          </select>
        </div>
      </div>
    </div>
  </div>
  <div class="flex mx-auto w-full items-center justify-between px-4 z-0 pt-24">
    <span class="component" id="component">Empty</span>
    <div class="flex justify-end w-max space-x-2">
      <button id="exportCSS"
        class="flex items-center export text-center text-xs py-2 px-3 w-fit rounded-lg focus:outline-none"
        onclick="exportCSS()">
        <svg width="30" height="30" viewBox="0 0 30 30" fill="none" class="icon" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M15.0001 2.09998C15.4972 2.09998 15.9001 2.50292 15.9001 2.99998V16.8272L20.3638 12.3636C20.7152 12.0121 21.285 12.0121 21.6364 12.3636C21.988 12.7151 21.988 13.2849 21.6364 13.6364L15.6365 19.6364C15.285 19.9878 14.7152 19.9878 14.3637 19.6364L8.3637 13.6364C8.01222 13.2849 8.01222 12.7151 8.3637 12.3636C8.71518 12.0121 9.28502 12.0121 9.6365 12.3636L14.1001 16.8272V2.99998C14.1001 2.50292 14.503 2.09998 15.0001 2.09998ZM5 20C5.55228 20 6 20.4478 6 21V24C6 25.1078 6.8913 26 7.9927 26H22.0024C23.1058 26 24 25.1056 24 24V21C24 20.4478 24.4478 20 25 20C25.5522 20 26 20.4478 26 21V24C26 26.2082 24.2124 28 22.0024 28H7.9927C5.78038 28 4 26.206 4 24V21C4 20.4478 4.44772 20 5 20Z"
            fill="currentColor" />
        </svg>Export</button>
      <button id="copyCSS"
        class="flex items-center export text-center text-xs py-2 px-3 w-fit rounded-lg focus:outline-none"
        onclick="createCSS()">
        <svg width="30" height="30" viewBox="0 0 30 30" fill="none" class="icon" xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M2 19.0001C2 20.657 3.34314 22.0002 5 22.0002H8V20.0002H5C4.44772 20.0002 4 19.5524 4 19.0001V5.00012C4 4.44784 4.44772 4.00012 5 4.00012H19C19.5523 4.00012 20 4.44784 20 5.00012V8.00004H11C9.34316 8.00004 8 9.34318 8 11V25C8 26.6568 9.34316 28 11 28H25C26.6568 28 28 26.6568 28 25V11C28 9.34318 26.6568 8.00004 25 8.00004H22V5.00012C22 3.34326 20.6568 2.00012 19 2.00012H5C3.34314 2.00012 2 3.34326 2 5.00012V19.0001ZM10 11C10 10.4478 10.4477 10 11 10H25C25.5522 10 26 10.4478 26 11V25C26 25.5524 25.5522 26 25 26H11C10.4477 26 10 25.5524 10 25V11Z"
            fill="currentColor" />
        </svg>Copy</button>
    </div>
  </div>
  <div class="overflow-y-auto pt-4">
    <div class="flex flex-col mx-auto w-full px-4 pb-24">
      <div class="flex w-full">
        <form id="resetPx" class="w-full space-y-2"></form>
      </div>
      <div class=" container-bottom w-full fixed z-1 p-4 bottom-0 left-0 right-0 mx-auto flex justify-center">
        <div class="flex justify-center w-full space-x-4">
          <button id="convert"
            class="text-center text-sm font-bold py-2 px-4 w-fit rounded-lg focus:outline-none">Update
            conversion</button>
          <button id="reset"
            class="text-center text-sm font-bold py-2 px-4 w-fit rounded-lg focus:outline-none">Reset</button>
        </div>
      </div>
    </div>
  </div>
</body>

<script>
  document.addEventListener(
    "DOMContentLoaded",
    () => (document.body.style.display = "")
  );

  let resultArray = [];
  let pluginData = {};
  let json = {};

  const resetPx = document.getElementById("resetPx");

  const fields = [
    { label: 'X', id: 'xPx', defaultValue: '0', property: 'x', resultId: 'xResult' },
    { label: 'Y', id: 'yPx', defaultValue: '0', property: 'y', resultId: 'yResult' },
    { label: 'Width', id: 'widthPx', defaultValue: '0', property: 'width', resultId: 'widthResult' },
    { label: 'Height', id: 'heightPx', defaultValue: '0', property: 'height', resultId: 'heightResult' },
    { label: 'Corner radius', id: 'radiusPx', defaultValue: '0', property: 'cornerRadius', resultId: 'radiusResult' },
    { label: 'Item spacing', id: 'itemSpacingPx', defaultValue: '0', property: 'itemSpacing', resultId: 'itemSpacingResult' },
    { label: 'Padding top', id: 'paddingTPx', defaultValue: '0', property: 'paddingTop', resultId: 'paddingTResult' },
    { label: 'Padding right', id: 'paddingRPx', defaultValue: '0', property: 'paddingRight', resultId: 'paddingRResult' },
    { label: 'Padding bottom', id: 'paddingBPx', defaultValue: '0', property: 'paddingBottom', resultId: 'paddingBResult' },
    { label: 'Padding left', id: 'paddingLPx', defaultValue: '0', property: 'paddingLeft', resultId: 'paddingLResult' },
    { label: 'Stroke width', id: 'strokePx', defaultValue: '0', property: 'strokeWeight', resultId: 'strokeResult' },
    { label: 'Font-size', id: 'textPx', defaultValue: '0', property: 'fontSize', resultId: 'textResult' },
    { label: 'Line-height', id: 'lineHeightPx', defaultValue: '0', property: 'lineHeight', resultId: 'lineHeightResult' },
    { label: 'Letter-spacing', id: 'letterSpacingPx', defaultValue: '0', property: 'letterSpacing', resultId: 'letterSpacingResult' }
  ];

  fields.forEach(field => {
    const div = document.createElement('div');
    div.classList.add('flex', 'w-full', 'items-end', 'justify-between');
    div.innerHTML = `
    <div class="flex flex-col items-start justify-center">
      <h4 class="font-medium text-sm">${field.label}</h4>
      <div class="flex items-end space-x-2">
        <input type="number" class="w-20 py-2 p-2 text-sm font-medium border-2 rounded-lg focus:outline-none"
          id="${field.id}" value="${field.defaultValue}">
        <span class="px">px</span>
      </div>
    </div>
    <div class="flex">
      <span id="${field.resultId}" class="w-full leading-none font-bold font-mono">0.00</span><span
        class="w-max leading-none font-bold font-mono">rem</span>
    </div>
  `;
    resetPx.appendChild(div);
  });

  const updateResult = (value, field) => {
    const numericValue = Number(value);
    if (!isNaN(numericValue)) {
      const result = pxToRem(numericValue);
      const remValue = result().toFixed(2) || 0;
      document.getElementById(field.resultId).innerHTML = remValue;
    } else {
      document.getElementById(field.resultId).innerHTML = "0.00";
    }
  };

  const resetFields = () => {
    fields.forEach(field => {
      document.getElementById(field.id).value = '0';
      document.getElementById(field.resultId).innerHTML = '0.00';
    });
    document.getElementById('component').innerHTML = '';
  };

  onmessage = (event) => {
    const pluginData = event.data.pluginMessage;

    if (Object.keys(pluginData).length === 0) {
      resetFields();
      return;
    }

    fields.forEach(field => {
      const value = pluginData[field.property];
      if (value !== undefined) {
        document.getElementById(field.id).value = value.toFixed(0);
        updateResult(value, field);
      }
    });

    if (pluginData.component !== undefined) {
      document.getElementById('component').innerHTML = pluginData.component;
    }
  };

  document.getElementById('convert').onclick = () => {
    fields.forEach(field => {
      const element = document.getElementById(field.id);
      const result = pxToRem(element.value)
      const remValue = result().toFixed(2) || 0;
      document.getElementById(field.resultId).innerHTML = remValue;
    });
  };


  document.getElementById('reset').onclick = () => {
    document.getElementById('resetPx').reset();
    document.getElementById('component').innerHTML = "EMPTY"
    const idArray = [
      'textResult',
      'lineHeightResult',
      'letterSpacingResult',
      'widthResult',
      'heightResult',
      'radiusResult',
      'strokeResult',
      'xResult',
      'yResult',
      'paddingTResult',
      'paddingBResult',
      'paddingLResult',
      'paddingRResult',
      'itemSpacingResult'
    ]
    idArray.forEach((id) => {
      document.getElementById(id).innerHTML = 0.00.toFixed(2)
    })
  }

  function pxToRem(px) {
    var baseValue = document.getElementById('newPx').value;
    var scale = document.getElementById('scale').value;

    function calculate() {
      return (px / baseValue) * scale;
    }

    return calculate;
  }

  function createCSS() {
    const css = [];

    const text = document.getElementById('textPx');
    const textResult = pxToRem(text.value);
    if (textResult() !== 0) {
      css.push(`font-size: ${textResult().toFixed(2)}rem`);
    }

    const lineHeight = document.getElementById('lineHeightPx');
    const lHResult = pxToRem(lineHeight.value);
    if (lHResult() !== 0) {
      css.push(`line-height: ${lHResult === 'AUTO' ? 'AUTO' : lHResult().toFixed(2)}rem`);
    }

    const letterSpacing = document.getElementById('letterSpacingPx');
    const LSResult = pxToRem(letterSpacing.value);
    if (LSResult() !== 0) {
      css.push(`letter-spacing: ${LSResult().toFixed(2)}rem`);
    }

    const width = document.getElementById('widthPx');
    const wResult = pxToRem(width.value);
    if (wResult() !== 0) {
      css.push(`width: ${wResult().toFixed(2)}rem`);
    }

    const height = document.getElementById('heightPx');
    const hResult = pxToRem(height.value);
    if (hResult() !== 0) {
      css.push(`height: ${hResult().toFixed(2)}rem`);
    }

    const radius = document.getElementById('radiusPx');
    const rResult = pxToRem(radius.value);
    if (rResult() !== 0) {
      css.push(`border-radius: ${rResult().toFixed(2)}rem`);
    }

    const stroke = document.getElementById('strokePx');
    const sResult = pxToRem(stroke.value);
    if (sResult() !== 0) {
      css.push(`border-width: ${sResult().toFixed(2)}rem`);
    }

    const x = document.getElementById('xPx');
    const xResult = pxToRem(x.value);
    if (xResult() !== 0) {
      css.push(`left: ${xResult().toFixed(2)}rem`);
    }

    const y = document.getElementById('yPx');
    const yResult = pxToRem(y.value);
    if (yResult() !== 0) {
      css.push(`top: ${yResult().toFixed(2)}rem`);
    }

    const paddingT = document.getElementById('paddingTPx');
    const pTResult = pxToRem(paddingT.value);
    if (pTResult() !== 0) {
      css.push(`padding-top: ${pTResult().toFixed(2)}rem`);
    }

    const paddingB = document.getElementById('paddingBPx');
    const pBResult = pxToRem(paddingB.value);
    if (pBResult() !== 0) {
      css.push(`padding-bottom: ${pBResult().toFixed(2)}rem`);
    }

    const paddingL = document.getElementById('paddingLPx');
    const pLResult = pxToRem(paddingL.value);
    if (pLResult() !== 0) {
      css.push(`padding-left: ${pLResult().toFixed(2)}rem`);
    }

    const paddingR = document.getElementById('paddingRPx');
    const pRResult = pxToRem(paddingR.value);
    if (pRResult() !== 0) {
      css.push(`padding-right: ${pRResult().toFixed(2)}rem`);
    }

    const itemSpacing = document.getElementById('itemSpacingPx');
    const iSResult = pxToRem(itemSpacing.value);
    if (iSResult() !== 0) {
      css.push(`gap: ${iSResult().toFixed(2)}rem`);
    }

    const cssString = css.join('; ');

    console.log(cssString);

    const string = JSON.stringify(cssString, null, 2);
    const tempInput = document.createElement('textarea');
    tempInput.value = string.replace(/"/g, '');
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);

    const originalText = document.getElementById('copyCSS').innerHTML;
    document.getElementById('copyCSS').innerText = 'Copied!';

    setTimeout(() => {
      document.getElementById('copyCSS').innerHTML = originalText;
    }, 2000)
  }

  function exportCSS() {
    const css = [];

    const text = document.getElementById('textPx');
    const textResult = pxToRem(text.value);
    if (textResult() !== 0) {
      css.push(`font-size: ${textResult().toFixed(2)}rem`);
    }

    const lineHeight = document.getElementById('lineHeightPx');
    const lHResult = pxToRem(lineHeight.value);
    if (lHResult() !== 0) {
      css.push(`line-height: ${lHResult === 'AUTO' ? 'AUTO' : lHResult().toFixed(2)}rem`);
    }

    const letterSpacing = document.getElementById('letterSpacingPx');
    const LSResult = pxToRem(letterSpacing.value);
    if (LSResult() !== 0) {
      css.push(`letter-spacing: ${LSResult().toFixed(2)}rem`);
    }

    const width = document.getElementById('widthPx');
    const wResult = pxToRem(width.value);
    if (wResult() !== 0) {
      css.push(`width: ${wResult().toFixed(2)}rem`);
    }

    const height = document.getElementById('heightPx');
    const hResult = pxToRem(height.value);
    if (hResult() !== 0) {
      css.push(`height: ${hResult().toFixed(2)}rem`);
    }

    const radius = document.getElementById('radiusPx');
    const rResult = pxToRem(radius.value);
    if (rResult() !== 0) {
      css.push(`border-radius: ${rResult().toFixed(2)}rem`);
    }

    const stroke = document.getElementById('strokePx');
    const sResult = pxToRem(stroke.value);
    if (sResult() !== 0) {
      css.push(`border-width: ${sResult().toFixed(2)}rem`);
    }

    const x = document.getElementById('xPx');
    const xResult = pxToRem(x.value);
    if (xResult() !== 0) {
      css.push(`left: ${xResult().toFixed(2)}rem`);
    }

    const y = document.getElementById('yPx');
    const yResult = pxToRem(y.value);
    if (yResult() !== 0) {
      css.push(`top: ${yResult().toFixed(2)}rem`);
    }

    const paddingT = document.getElementById('paddingTPx');
    const pTResult = pxToRem(paddingT.value);
    if (pTResult() !== 0) {
      css.push(`padding-top: ${pTResult().toFixed(2)}rem`);
    }

    const paddingB = document.getElementById('paddingBPx');
    const pBResult = pxToRem(paddingB.value);
    if (pBResult() !== 0) {
      css.push(`padding-bottom: ${pBResult().toFixed(2)}rem`);
    }

    const paddingL = document.getElementById('paddingLPx');
    const pLResult = pxToRem(paddingL.value);
    if (pLResult() !== 0) {
      css.push(`padding-left: ${pLResult().toFixed(2)}rem`);
    }

    const paddingR = document.getElementById('paddingRPx');
    const pRResult = pxToRem(paddingR.value);
    if (pRResult() !== 0) {
      css.push(`padding-right: ${pRResult().toFixed(2)}rem`);
    }

    const itemSpacing = document.getElementById('itemSpacingPx');
    const iSResult = pxToRem(itemSpacing.value);
    if (iSResult() !== 0) {
      css.push(`gap: ${iSResult().toFixed(2)}rem`);
    }

    const cssString = css.join('; ');

    console.log(cssString);

    // Create a blob from the CSS string and download it as a file
    const blob = new Blob([cssString.replace(/"/g, '')], { type: 'text/css' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'handover-export.css';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>

<style>
  body {
    background-color: var(--figma-color-bg);
  }

  .container-top {
    background-color: var(--figma-color-bg);
    border-bottom: 1px solid var(--figma-color-border);
  }

  .container-bottom {
    background-color: var(--figma-color-bg);
    border-top: 1px solid var(--figma-color-border);
  }

  button {
    background-color: var(--figma-color-bg);
    border: 1px solid var(--figma-color-border);
    color: var(--figma-color-text);
    cursor: default;
    font-size: 1rem;

  }

  button:hover {
    background-color: var(--figma-color-bg-selected-hover);
    border: 1px solid var(--figma-color-border-selected);
  }

  button.export {
    background-color: var(--figma-color-bg-secondary);

  }

  button.export:hover {
    background-color: var(--figma-color-bg-secondary-hover);
    border: 1px solid var(--figma-color-border-strong);
  }

  h3 {
    color: var(--figma-color-text);
  }

  h4,
  h5 {
    color: var(--figma-color-text-secondary);
  }

  input {
    border: 2px solid var(--figma-color-border);
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
  }

  input:active {
    border: 2px solid var(--figma-color-border-onsuccess);
  }

  input:focus {
    border: 2px solid var(--figma-color-border-onsuccess);
  }

  select {
    border: 2px solid var(--figma-color-border);
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
  }

  select:active {
    border: 2px solid var(--figma-color-border-onsuccess);
  }

  select:focus {
    border: 2px solid var(--figma-color-border-onsuccess);
  }

  span {
    color: var(--figma-color-text-success);
  }

  span.px {
    color: var(--figma-color-text-secondary);
  }

  span.component {
    color: var(--figma-color-text-success);
    font-size: 0.6rem;
    text-transform: uppercase;
    border-radius: 999px;
    padding: 0.3rem 0.8rem;
    background-color: var(--figma-color-bg-success), 0.5;
    border: 1px solid var(--figma-color-border-onsuccess);
  }

  svg.icon {
    fill: var(--figma-color-text-secondary);
    width: 0.7rem;
    height: 0.7rem;
    margin-right: 0.25rem;
  }
</style>